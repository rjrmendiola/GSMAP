<div class="min-h-screen bg-gray-50 p-6">
  <!-- Header -->
  <div class="mb-6">
    <div class="flex justify-between items-center">
      <div>
        <h1 class="text-3xl font-bold text-gray-900">Evacuation Planner</h1>
        <p class="text-gray-600 mt-1">Strategic evacuation planning and resource allocation</p>
        <p class="text-sm text-gray-500 mt-1" *ngIf="evacuationData">
          Generated: {{ evacuationData.generatedAt | date:'medium' }}
        </p>
      </div>
      <div class="flex gap-2">
        <button (click)="loadEvacuationPlan()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
          Refresh
        </button>
        <button (click)="printPlan()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
          Print Plan
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="flex justify-center items-center py-20">
    <div class="text-center">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
      <p class="mt-4 text-gray-600">Loading evacuation plan...</p>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
    <p class="text-red-800">{{ error }}</p>
  </div>

  <!-- No Evacuation Needed -->
  <div *ngIf="!loading && evacuationData?.status === 'NO_EVACUATION_NEEDED'" class="bg-green-50 border border-green-200 rounded-lg p-8 text-center">
    <svg class="h-16 w-16 text-green-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>
    <h2 class="text-2xl font-bold text-green-800 mb-2">No Evacuation Currently Required</h2>
    <p class="text-green-700">All barangays are within safe thresholds. Continue monitoring conditions.</p>
  </div>

  <!-- Evacuation Required -->
  <div *ngIf="!loading && evacuationData?.status === 'EVACUATION_REQUIRED'">
    <!-- Summary Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
      <div class="bg-red-50 border-l-4 border-red-600 rounded-lg shadow p-6">
        <div class="text-sm font-medium text-red-800">Barangays Requiring Evacuation</div>
        <div class="mt-2 text-3xl font-bold text-red-600">{{ evacuationData.totalBarangays }}</div>
        <div class="mt-2 text-xs text-red-700">Immediate action required</div>
      </div>

      <div class="bg-orange-50 border-l-4 border-orange-500 rounded-lg shadow p-6">
        <div class="text-sm font-medium text-orange-800">Estimated Evacuees</div>
        <div class="mt-2 text-3xl font-bold text-orange-600">{{ evacuationData.totalEstimatedEvacuees | number }}</div>
        <div class="mt-2 text-xs text-orange-700">People to be evacuated</div>
      </div>

      <div class="bg-blue-50 border-l-4 border-blue-600 rounded-lg shadow p-6">
        <div class="text-sm font-medium text-blue-800">Active Evacuation Centers</div>
        <div class="mt-2 text-3xl font-bold text-blue-600">
          {{ totalEvacuationCenters }}
        </div>
        <div class="mt-2 text-xs text-blue-700">Centers to be activated</div>
      </div>
    </div>

    <!-- Resource Requirements Summary -->
    <div *ngIf="resourceSummary" class="bg-white rounded-lg shadow p-6 mb-6">
      <h2 class="text-xl font-bold mb-4 text-gray-900">Required Resources</h2>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <!-- Personnel -->
        <div>
          <h3 class="font-semibold text-gray-700 mb-2">Personnel</h3>
          <ul class="space-y-1 text-sm">
            <li class="flex justify-between">
              <span class="text-gray-600">Medical Staff:</span>
              <span class="font-semibold">{{ resourceSummary.personnel.medicalStaff }}</span>
            </li>
            <li class="flex justify-between">
              <span class="text-gray-600">Security:</span>
              <span class="font-semibold">{{ resourceSummary.personnel.securityPersonnel }}</span>
            </li>
            <li class="flex justify-between">
              <span class="text-gray-600">Social Workers:</span>
              <span class="font-semibold">{{ resourceSummary.personnel.socialWorkers }}</span>
            </li>
            <li class="flex justify-between">
              <span class="text-gray-600">Volunteers:</span>
              <span class="font-semibold">{{ resourceSummary.personnel.volunteers }}</span>
            </li>
          </ul>
        </div>

        <!-- Supplies -->
        <div>
          <h3 class="font-semibold text-gray-700 mb-2">Supplies</h3>
          <ul class="space-y-1 text-sm">
            <li class="flex justify-between">
              <span class="text-gray-600">Food Packs:</span>
              <span class="font-semibold">{{ resourceSummary.supplies.foodPacks | number }}</span>
            </li>
            <li class="flex justify-between">
              <span class="text-gray-600">Water Bottles:</span>
              <span class="font-semibold">{{ resourceSummary.supplies.waterBottles | number }}</span>
            </li>
            <li class="flex justify-between">
              <span class="text-gray-600">Blankets:</span>
              <span class="font-semibold">{{ resourceSummary.supplies.blankets }}</span>
            </li>
            <li class="flex justify-between">
              <span class="text-gray-600">Hygiene Kits:</span>
              <span class="font-semibold">{{ resourceSummary.supplies.hygieneKits }}</span>
            </li>
          </ul>
        </div>

        <!-- Equipment -->
        <div>
          <h3 class="font-semibold text-gray-700 mb-2">Equipment</h3>
          <ul class="space-y-1 text-sm">
            <li class="flex justify-between">
              <span class="text-gray-600">Generators:</span>
              <span class="font-semibold">{{ resourceSummary.equipment.generators }}</span>
            </li>
            <li class="flex justify-between">
              <span class="text-gray-600">Radios:</span>
              <span class="font-semibold">{{ resourceSummary.equipment.communicationRadios }}</span>
            </li>
            <li class="flex justify-between">
              <span class="text-gray-600">Flashlights:</span>
              <span class="font-semibold">{{ resourceSummary.equipment.flashlights }}</span>
            </li>
            <li class="flex justify-between">
              <span class="text-gray-600">Rescue Boats:</span>
              <span class="font-semibold">{{ resourceSummary.equipment.rescueBoats }}</span>
            </li>
          </ul>
        </div>

        <!-- Vehicles -->
        <div>
          <h3 class="font-semibold text-gray-700 mb-2">Vehicles</h3>
          <ul class="space-y-1 text-sm">
            <li class="flex justify-between">
              <span class="text-gray-600">Evacuation Vehicles:</span>
              <span class="font-semibold">{{ resourceSummary.vehicles.evacuationVehicles }}</span>
            </li>
            <li class="flex justify-between">
              <span class="text-gray-600">Ambulances:</span>
              <span class="font-semibold">{{ resourceSummary.vehicles.ambulances }}</span>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Evacuation Plans List -->
    <div class="space-y-4">
      <h2 class="text-xl font-bold text-gray-900">Barangay Evacuation Plans</h2>

      <div *ngFor="let plan of evacuationPlans" class="bg-white rounded-lg shadow hover:shadow-lg transition-shadow cursor-pointer"
           (click)="selectPlan(plan)">
        <div class="p-6">
          <div class="flex justify-between items-start">
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-2">
                <h3 class="text-xl font-bold text-gray-900">{{ plan.barangayName }}</h3>
                <span [class]="'px-3 py-1 rounded-full text-sm font-semibold ' + getPriorityBadgeClass(plan.priority)">
                  Priority {{ plan.priority }}
                </span>
                <span class="px-3 py-1 rounded-full text-sm font-semibold bg-gray-200">
                  {{ plan.alertLevel }}
                </span>
              </div>

              <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4 text-sm">
                <div>
                  <span class="text-gray-600">Population:</span>
                  <span class="ml-2 font-semibold">{{ plan.population | number }}</span>
                </div>
                <div>
                  <span class="text-gray-600">Est. Evacuees:</span>
                  <span class="ml-2 font-semibold text-orange-600">{{ plan.estimatedEvacuees | number }}</span>
                </div>
                <div>
                  <span class="text-gray-600">Evacuation Rate:</span>
                  <span class="ml-2 font-semibold">{{ plan.evacuationRate }}</span>
                </div>
                <div>
                  <span class="text-gray-600">Centers:</span>
                  <span class="ml-2 font-semibold">{{ plan.evacuationCenters.length }}</span>
                </div>
              </div>

              <div class="mb-4">
                <div class="flex items-center gap-2">
                  <span class="text-sm font-semibold text-gray-700">Capacity Status:</span>
                  <span [class]="'text-sm font-semibold ' + getCapacityStatusClass(plan.capacityStatus.status)">
                    {{ plan.capacityStatus.message }} ({{ plan.capacityStatus.utilizationRate }})
                  </span>
                </div>
              </div>

              <div class="flex flex-wrap gap-2">
                <span *ngIf="plan.risks.flood !== 'GREEN'" class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">
                  Flood: {{ plan.risks.flood }}
                </span>
                <span *ngIf="plan.risks.landslide !== 'GREEN'" class="px-2 py-1 bg-orange-100 text-orange-800 rounded text-xs">
                  Landslide: {{ plan.risks.landslide }}
                </span>
                <span *ngIf="plan.risks.wind !== 'GREEN'" class="px-2 py-1 bg-purple-100 text-purple-800 rounded text-xs">
                  Wind: {{ plan.risks.wind }}
                </span>
              </div>
            </div>

            <button class="text-blue-600 hover:text-blue-800 font-medium text-sm">View Details â†’</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Plan Detail Modal -->
  <div *ngIf="selectedPlan" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
       (click)="closeDetail()">
    <div class="bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-y-auto" (click)="$event.stopPropagation()">
      <div class="sticky top-0 bg-white border-b p-6 flex justify-between items-center">
        <h2 class="text-2xl font-bold">{{ selectedPlan.barangayName }} - Evacuation Plan</h2>
        <button (click)="closeDetail()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
      </div>

      <div class="p-6">
        <!-- Overview -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
          <div class="bg-gray-50 rounded-lg p-4">
            <div class="text-sm text-gray-600">Priority</div>
            <div class="text-2xl font-bold">{{ selectedPlan.priority }}</div>
          </div>
          <div class="bg-gray-50 rounded-lg p-4">
            <div class="text-sm text-gray-600">Population</div>
            <div class="text-2xl font-bold">{{ selectedPlan.population | number }}</div>
          </div>
          <div class="bg-orange-50 rounded-lg p-4">
            <div class="text-sm text-orange-800">Evacuees</div>
            <div class="text-2xl font-bold text-orange-600">{{ selectedPlan.estimatedEvacuees | number }}</div>
          </div>
          <div class="bg-blue-50 rounded-lg p-4">
            <div class="text-sm text-blue-800">Capacity</div>
            <div class="text-2xl font-bold text-blue-600">{{ selectedPlan.totalCapacity | number }}</div>
          </div>
        </div>

        <!-- Timeline -->
        <div class="mb-6">
          <h3 class="text-xl font-semibold mb-3">Evacuation Timeline</h3>
          <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <span class="font-semibold text-gray-700">Warning:</span>
                <span class="ml-2">{{ selectedPlan.timeline.warning }}</span>
              </div>
              <div>
                <span class="font-semibold text-gray-700">Vulnerable Groups:</span>
                <span class="ml-2">{{ selectedPlan.timeline.vulnerableGroups }}</span>
              </div>
              <div>
                <span class="font-semibold text-gray-700">General Population:</span>
                <span class="ml-2">{{ selectedPlan.timeline.generalPopulation }}</span>
              </div>
              <div>
                <span class="font-semibold text-gray-700">Deadline:</span>
                <span class="ml-2 font-semibold text-red-600">{{ selectedPlan.timeline.deadline }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Evacuation Order -->
        <div class="mb-6">
          <h3 class="text-xl font-semibold mb-3">Evacuation Priority Order</h3>
          <div class="space-y-2">
            <div *ngFor="let order of selectedPlan.evacuationOrder" class="border-l-4 border-red-500 bg-gray-50 p-4 rounded">
              <div class="flex items-start gap-3">
                <span class="bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold text-sm">
                  {{ order.priority }}
                </span>
                <div>
                  <h4 class="font-semibold text-gray-900">{{ order.group }}</h4>
                  <p class="text-sm text-gray-600 mt-1">{{ order.action }}</p>
                  <ul *ngIf="order.members" class="list-disc list-inside text-xs text-gray-500 mt-2">
                    <li *ngFor="let member of order.members">{{ member }}</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Evacuation Centers -->
        <div class="mb-6">
          <h3 class="text-xl font-semibold mb-3">Evacuation Centers Assignment</h3>
          <div class="space-y-3">
            <div *ngFor="let center of selectedPlan.evacuationCenters" class="border rounded-lg p-4"
                 [class.bg-red-50]="center.status === 'FULL'"
                 [class.bg-orange-50]="center.status === 'OVERFLOW'"
                 [class.bg-green-50]="center.status === 'AVAILABLE'">
              <div class="flex justify-between items-start">
                <div>
                  <h4 class="font-semibold text-lg">{{ center.name }}</h4>
                  <p class="text-sm text-gray-600">{{ center.venue }}</p>
                  <p class="text-xs text-gray-500 mt-1">Contact: {{ center.contactPerson }}</p>
                </div>
                <div class="text-right">
                  <div class="text-sm font-semibold"
                       [class.text-red-600]="center.status === 'FULL'"
                       [class.text-orange-600]="center.status === 'OVERFLOW'"
                       [class.text-green-600]="center.status === 'AVAILABLE'">
                    {{ center.status }}
                  </div>
                  <div class="text-xs text-gray-600 mt-1">{{ center.utilizationRate }}</div>
                </div>
              </div>
              <div class="mt-3 grid grid-cols-2 gap-2 text-sm">
                <div>
                  <span class="text-gray-600">Capacity:</span>
                  <span class="ml-2 font-semibold">{{ center.capacity }}</span>
                </div>
                <div>
                  <span class="text-gray-600">Assigned:</span>
                  <span class="ml-2 font-semibold">{{ center.assignedEvacuees }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Routes -->
        <div class="mb-6">
          <h3 class="text-xl font-semibold mb-3">Evacuation Routes</h3>
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
            <div class="mb-3">
              <h4 class="font-semibold text-blue-900">Primary Route:</h4>
              <p class="text-sm">{{ selectedPlan.routes.primary }}</p>
            </div>
            <div *ngIf="selectedPlan.routes.avoid.length > 0" class="mb-3">
              <h4 class="font-semibold text-red-900">Avoid:</h4>
              <ul class="list-disc list-inside text-sm">
                <li *ngFor="let avoid of selectedPlan.routes.avoid">{{ avoid }}</li>
              </ul>
            </div>
            <div>
              <h4 class="font-semibold text-gray-900">Recommendations:</h4>
              <ul class="list-disc list-inside text-sm">
                <li *ngFor="let rec of selectedPlan.routes.recommendations">{{ rec }}</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Special Needs -->
        <div>
          <h3 class="text-xl font-semibold mb-3">Special Needs Population</h3>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="bg-pink-50 rounded-lg p-4 text-center">
              <div class="text-2xl font-bold text-pink-600">{{ selectedPlan.specialNeeds.medical }}</div>
              <div class="text-sm text-gray-600">Medical Attention</div>
            </div>
            <div class="bg-purple-50 rounded-lg p-4 text-center">
              <div class="text-2xl font-bold text-purple-600">{{ selectedPlan.specialNeeds.mobility }}</div>
              <div class="text-sm text-gray-600">Mobility Assistance</div>
            </div>
            <div class="bg-blue-50 rounded-lg p-4 text-center">
              <div class="text-2xl font-bold text-blue-600">{{ selectedPlan.specialNeeds.infants }}</div>
              <div class="text-sm text-gray-600">Infants</div>
            </div>
            <div class="bg-green-50 rounded-lg p-4 text-center">
              <div class="text-2xl font-bold text-green-600">{{ selectedPlan.specialNeeds.dietary }}</div>
              <div class="text-sm text-gray-600">Special Dietary</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
